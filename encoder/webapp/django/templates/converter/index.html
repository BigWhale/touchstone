{% extends "base.html" %}

{% block title %}
<title>{{ title }}</title>
{% endblock %}

{% block body %}
<div class="container">

    <p>
    <label>Pick a file to upload
        <input id="upfile" type="file" name="upfile" />
    </label>

    <div id="progress-bar" class="progress">
        <div class="progress-bar"></div>
    </div>

</div>

<script type="text/javascript">

// Custom jQuery xhr instance to support our progress bar.
var xhr_with_progress = function() {
    var xhr = new window.XMLHttpRequest();
    xhr.upload.addEventListener("progress",
        function(evt) {
            if (!evt.lengthComputable) return;
            var percentComplete = evt.loaded / evt.total;
            $("#progress-bar div.progress-bar").css('width', String(100*percentComplete) + "%");
        }, false);
    return xhr;
};

$(document).ready(function() {
    $("#upfile").on('change', function (e) {
        var fr = new FileReader();
        var filename;
        fr.onload = function(e) {
            $.ajax({
                xhr: xhr_with_progress,
                url:"{{ upload_url }}",
                type: 'PUT',
                cache: false,
                data: fr.result,
                processData: false,

                success: function (data) {
                var success_url = "{{ redirect_url }}" + "&filename=" + filename
                    window.location = success_url
                },

                error: function (data) {
                }
            });
        };
        file = this.files[0];
        filename = file.name
        fr.readAsArrayBuffer(this.files[0]);
    });
});

</script>

{% endblock %}
